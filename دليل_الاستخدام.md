# 🗳️ دليل استخدام بوت استعلام بيانات الناخبين

## 📋 نظرة عامة
برنامج آلي لاستخراج بيانات الناخبين من موقع الهيئة العليا للانتخابات المصرية باستخدام الأرقام القومية المخزنة في Google Sheets.

---

## ✅ الإعداد الأولي

### 1. تكامل Google Sheets
✅ **تم الإعداد بالفعل!** التكامل مع Google Sheets نشط ويعمل.

### 2. إعداد Google Sheet الخاص بك

#### خطوة 1: إنشاء Google Sheet جديد
1. افتح [Google Sheets](https://sheets.google.com)
2. أنشئ ملف جديد
3. انسخ معرف الملف (الموجود في URL بين `/d/` و `/edit`)
   - مثال: `https://docs.google.com/spreadsheets/d/**1-rCGPx6vyEMm3zmR7ks3xZh63XcJk4ks78e5e9jfuyo**/edit`

#### خطوة 2: إعداد ورقة "Voters" (الناخبين)
أنشئ ورقة باسم **Voters** بالتنسيق التالي:

| العمود A | العمود B (الرقم القومي) | العمود C (الاسم) |
|---------|------------------------|------------------|
| 1       | 29012011234567         | أحمد محمد         |
| 2       | 29103011234568         | فاطمة علي         |
| 3       | 29204011234569         | محمود حسن        |

**ملاحظات مهمة:**
- ✅ الأرقام القومية يجب أن تكون في **العمود B**
- ✅ الأسماء يجب أن تكون في **العمود C**
- ✅ الصف الأول يحتوي على العناوين (سيتم تجاهله تلقائياً)
- ✅ الأرقام القومية يجب أن تكون **14 رقم**

#### خطوة 3: تحديث معرف الملف
1. افتح ملف `main.py`
2. ابحث عن السطر:
   ```python
   SPREADSHEET_ID = "1-rCGPx6vyEMm3zmR7ks3xZh63XcJk4ks78e5e9jfuyo"
   ```
3. استبدل القيمة بمعرف ملفك

---

## 🚀 طريقة الاستخدام

### الطريقة 1: استخدام لوحة التحكم (Dashboard) 🖥️

1. **افتح لوحة التحكم**
   - لوحة التحكم تعمل تلقائياً على المنفذ 5000
   - ستجد واجهة جميلة باللغة العربية

2. **ابدأ العملية**
   - اضغط على زر **"▶️ بدء العملية"**
   - ستبدأ العملية تلقائياً في استعلام الأرقام القومية

3. **راقب التقدم**
   - **آخر صف معالج**: رقم آخر صف تمت معالجته
   - **إجمالي المعالج**: عدد الصفوف التي تمت معالجتها
   - **الحالة**: حالة البرنامج الحالية
   - **سجل العمليات**: تفاصيل العملية الجارية

4. **إيقاف/استئناف العملية**
   - اضغط **"⏸️ إيقاف العملية"** لإيقاف مؤقت
   - يمكنك الاستئناف لاحقاً من نفس النقطة

5. **إعادة تعيين التقدم**
   - اضغط **"🔄 إعادة تعيين التقدم"** للبدء من جديد
   - سيتم حذف ملف `progress.json`

### الطريقة 2: تشغيل مباشر من Terminal

```bash
python main.py
```

---

## 📊 النتائج

### مكان النتائج
سيتم إنشاء ورقة جديدة في نفس Google Sheet باسم **"نتائج_الاستعلام"** تحتوي على:

| الاسم | الرقم القومي | مركز الانتخاب | العنوان | رقم اللجنة الفرعية | الرقم في الكشوف | الحالة | ملاحظات |
|------|-------------|--------------|---------|-------------------|----------------|--------|---------|
| أحمد محمد | 29012011234567 | مدرسة النصر الابتدائية | شارع الجلاء، القاهرة | 15 | 250 | success | |

### حالات النتائج
- ✅ **success**: تم استخراج البيانات بنجاح
- ❌ **error**: حدث خطأ (رقم قومي غير صحيح، Captcha، إلخ)
- ⏳ **unknown**: لم يتم العثور على بيانات

---

## 🔄 نظام المتابعة والاستئناف

### التقدم التلقائي
يحفظ البرنامج التقدم تلقائياً في ملف `progress.json`:

```json
{
  "last_row": 150,
  "total_processed": 150,
  "last_updated": "2025-10-28T15:30:00"
}
```

### الاستئناف بعد التوقف
- إذا توقف البرنامج لأي سبب (انقطاع كهرباء، خطأ، إلخ)
- قم بتشغيله مرة أخرى
- سيبدأ **تلقائياً** من آخر صف تمت معالجته
- لن يتم إعادة معالجة الصفوف السابقة

### البدء من جديد
```bash
rm progress.json
python main.py
```

---

## 🔧 الإعدادات المتقدمة

### تعديل الإعدادات في main.py

```python
# معرف Google Sheet
SPREADSHEET_ID = "1-rCGPx6vyEMm3zmR7ks3xZh63XcJk4ks78e5e9jfuyo"

# اسم الورقة المصدر (تحتوي على الأرقام القومية)
SOURCE_SHEET = "Voters"

# اسم ورقة النتائج (سيتم إنشاؤها تلقائياً)
RESULTS_SHEET = "نتائج_الاستعلام"

# رابط موقع الاستعلام
INQUIRY_URL = "https://www.elections.eg/inquiry"

# الحد الأقصى للصفوف
MAX_ROWS = 80000
```

### تعديل السرعة

في ملف `main.py`، ابحث عن:
```python
time.sleep(2)  # انتظار بين كل استعلام
```

⚠️ **تحذير**: تقليل وقت الانتظار قد يؤدي لحجب IP من الموقع!

---

## 🐛 استكشاف الأخطاء

### المشكلة: لم يتم استخراج مركز الانتخاب

**الحل:**
1. **تحليل الصفحة**:
   - عند فشل استخراج مركز الانتخاب، يتم حفظ ملف HTML تلقائياً
   - اسم الملف: `debug_page_[الرقم القومي].html`
   - افتح الملف وفحص هيكل الصفحة

2. **فحص السجلات**:
   - افحص "سجل العمليات" في لوحة التحكم
   - ستجد رسالة: "📄 عينة من نص الصفحة..."
   - هذا يساعد في معرفة كيف يظهر النص

3. **تحديث أنماط البحث**:
   - إذا تغير هيكل موقع الانتخابات
   - عدّل القائمة `center_patterns` في `main.py`

### المشكلة: خطأ في الاتصال بـ Google Sheets

**الحل:**
- تأكد من إعداد تكامل Google Sheets في Replit
- تأكد من صحة معرف الملف `SPREADSHEET_ID`

### المشكلة: Captcha

**الحل:**
- هذا يحدث عند كثرة الطلبات
- انتظر بضع دقائق ثم حاول مرة أخرى
- زد وقت الانتظار بين الطلبات

### المشكلة: الورقة فارغة

**الحل:**
- تأكد من وجود ورقة باسم **"Voters"** بالضبط
- تأكد من وجود بيانات في العمود B (الأرقام القومية)

---

## ⚙️ المعلومات التقنية

### المكتبات المستخدمة
- `gspread` - التعامل مع Google Sheets
- `google-auth` - المصادقة مع Google APIs
- `selenium` - التحكم الآلي بالمتصفح
- `beautifulsoup4` - تحليل HTML
- `pandas` - معالجة البيانات
- `flask` - لوحة التحكم Web
- `chromium` - المتصفح
- `chromedriver` - التحكم في Chromium

### الأداء
- **السرعة**: حوالي 1-2 صف في الثانية
- **الوقت المتوقع**:
  - 100 صف: ~2-3 دقائق
  - 1000 صف: ~20-30 دقيقة
  - 10000 صف: ~3-5 ساعات
  - 80000 صف: ~44-88 ساعة

---

## 📱 دعم إضافي

### طرق بديلة للاستعلام
إذا واجهت مشاكل مع البرنامج، يمكنك استخدام:

1. **رسالة SMS**:
   - أرسل الرقم القومي إلى **5151**

2. **الخط الساخن**:
   - اتصل بـ **141** أو **140**

3. **الموقع الإلكتروني**:
   - https://www.elections.eg/inquiry

---

## ⚠️ ملاحظات مهمة

### القانون والخصوصية
- 🔒 هذه الأداة للاستخدام الشخصي والتعليمي فقط
- 🔒 احترم قوانين الاستخدام لموقع الهيئة العليا للانتخابات
- 🔒 لا تشارك بيانات الناخبين مع جهات غير مصرح لها

### الأمان
- 🔐 لا تشارك ملف `credentials.json` مع أحد
- 🔐 لا تنشر معلومات Google Sheets على الإنترنت
- 🔐 البيانات الشخصية للناخبين محمية بقوانين الخصوصية

### الاستخدام المسؤول
- ⚡ استخدم الأداة بشكل معتدل
- ⚡ لا تبالغ في عدد الطلبات
- ⚡ احترم موارد الخادم

---

## 📞 الدعم الفني

إذا واجهت أي مشاكل:
1. راجع قسم "استكشاف الأخطاء" أعلاه
2. افحص السجلات في لوحة التحكم
3. افحص الملفات المحفوظة: `debug_page_*.html`

---

## 🎉 نصائح للاستخدام الأمثل

✅ **ابدأ باختبار صغير**:
   - جرّب 10-20 رقم قومي أولاً
   - تأكد من أن البيانات تُستخرج بشكل صحيح
   - ثم قم بمعالجة الكمية الكبيرة

✅ **راقب التقدم**:
   - افتح لوحة التحكم دائماً
   - راقب السجلات للتأكد من عدم وجود أخطاء

✅ **احتفظ بنسخة احتياطية**:
   - قم بتحميل Google Sheet بانتظام
   - احتفظ بنسخة من ملف `progress.json`

---

**تم التحديث**: 28 أكتوبر 2025
**الإصدار**: 2.0 (مع تحسينات استخراج البيانات)
