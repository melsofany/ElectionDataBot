# تعليمات الإعداد التفصيلية

## الخطوة 1: الحصول على Google Service Account Credentials

### 1.1 إنشاء مشروع في Google Cloud

1. اذهب إلى [Google Cloud Console](https://console.cloud.google.com/)
2. اضغط على **Select a project** في الشريط العلوي
3. اضغط **NEW PROJECT**
4. أدخل اسم المشروع (مثل: "Voter Inquiry Bot")
5. اضغط **CREATE**

### 1.2 تفعيل APIs المطلوبة

1. من القائمة الجانبية، اذهب إلى **APIs & Services > Library**
2. ابحث عن "Google Sheets API"
3. اضغط عليه ثم اضغط **ENABLE**
4. ارجع للمكتبة وكرر نفس الخطوات لـ "Google Drive API"

### 1.3 إنشاء Service Account

1. من القائمة الجانبية، اذهب إلى **APIs & Services > Credentials**
2. اضغط **+ CREATE CREDENTIALS**
3. اختر **Service Account**
4. املأ البيانات:
   - Service account name: `voter-bot`
   - Service account ID: سيتم ملؤه تلقائياً
   - Description: "Bot for voter inquiry"
5. اضغط **CREATE AND CONTINUE**
6. اضغط **DONE** (لا حاجة لإضافة roles)

### 1.4 إنشاء مفتاح JSON

1. في صفحة Credentials، ستجد Service Account الذي أنشأته
2. اضغط على اسم الـ Service Account
3. اذهب لتبويب **KEYS**
4. اضغط **ADD KEY > Create new key**
5. اختر **JSON**
6. اضغط **CREATE**
7. سيتم تحميل ملف JSON تلقائياً على جهازك

### 1.5 تحميل الملف إلى Replit

1. في مشروع Replit، اضغط على أيقونة الملفات
2. اضغط على زر الثلاث نقاط واختر **Upload file**
3. اختر ملف JSON الذي حمّلته
4. أعد تسمية الملف إلى **credentials.json**

### 1.6 مشاركة Google Sheet مع Service Account

⚠️ **هذه الخطوة إلزامية وضرورية!**

1. افتح ملف `credentials.json` في Replit
2. ابحث عن السطر الذي يحتوي على `"client_email"`
3. انسخ البريد الإلكتروني (سيكون مثل: `voter-bot@project-123.iam.gserviceaccount.com`)
4. افتح Google Sheet الخاص بك ([الرابط](https://docs.google.com/spreadsheets/d/1-rCGPx6vyEMm3zmR7ks3xZh63XcJk4ks78e5e9jfuyo/edit))
5. اضغط زر **مشاركة (Share)** في الأعلى
6. الصق البريد الإلكتروني للـ Service Account
7. تأكد من اختيار **Editor** (محرر)
8. اضغط **مشاركة (Share)**

---

## الخطوة 2: إعداد Google Sheet

### 2.1 هيكل الورقة المطلوب

يجب أن يكون Google Sheet منظماً كالتالي:

**ورقة "Voters":**

| A | B | C |
|---|---|---|
| أي بيانات | 29012011234567 | أحمد محمد |
| أي بيانات | 29103011234568 | فاطمة علي |
| أي بيانات | 29204011234569 | محمود حسن |

**ملاحظات:**
- الصف الأول (رقم 1) للعناوين - سيتم تجاهله
- العمود B يجب أن يحتوي على الأرقام القومية (14 رقم)
- العمود C يحتوي على الأسماء (اختياري)
- يمكن للعمود A أن يحتوي على أي بيانات أو يكون فارغاً

### 2.2 التحقق من ID الجدول

تأكد أن ID الجدول في الكود هو نفسه ID جدولك:

```python
SPREADSHEET_ID = "1-rCGPx6vyEMm3zmR7ks3xZh63XcJk4ks78e5e9jfuyo"
```

لإيجاد ID جدولك:
- افتح Google Sheet
- انظر للرابط في المتصفح:
  ```
  https://docs.google.com/spreadsheets/d/[هذا_هو_الID]/edit
  ```

---

## الخطوة 3: تشغيل الأداة

### 3.1 التحقق من الإعداد

```bash
python setup_check.py
```

يجب أن تحصل على:
```
✓ تم العثور على ملف credentials في: credentials.json
✓ جميع المكتبات مثبتة
✓ ChromeDriver و Chromium جاهزان للاستخدام
✅ البيئة جاهزة للتشغيل!
```

### 3.2 التشغيل الأول

```bash
python main.py
```

### 3.3 الاستئناف بعد التوقف

إذا توقف البرنامج لأي سبب، فقط أعد تشغيله:

```bash
python main.py
```

سيبدأ تلقائياً من حيث توقف!

---

## استكشاف الأخطاء الشائعة

### خطأ: "لم يتم العثور على ملف credentials.json"

**الحل:**
- تأكد أن الملف اسمه **credentials.json** بالضبط
- تأكد أنه في المجلد الرئيسي للمشروع
- جرّب إعادة تحميله

### خطأ: "SpreadsheetNotFound" أو "gspread.exceptions.APIError"

**الحل:**
- تأكد من مشاركة الجدول مع Service Account Email
- راجع الخطوة 1.6 أعلاه
- تأكد أن ID الجدول صحيح

### خطأ: "WorksheetNotFound: Voters"

**الحل:**
- تأكد أن اسم الورقة داخل الجدول هو "Voters" بالضبط
- الاسم حساس لحالة الأحرف (case-sensitive)
- يمكنك تغيير الاسم في الكود:
  ```python
  SOURCE_SHEET = "اسم_الورقة_الجديد"
  ```

### الأداة بطيئة جداً

**هذا طبيعي:**
- البرنامج ينتظر 2-4 ثواني بين كل استعلام
- هذا لتجنب حظر IP من موقع الانتخابات
- يمكنك تقليل الوقت (غير موصى به):
  ```python
  time.sleep(1)  # بدلاً من 2 أو 4
  ```

### الحقول فارغة أو "no_data"

**الحل:**
- موقع الانتخابات قد يكون تغير
- راجع قسم "كيفية تحديث استخراج البيانات" في README.md
- قد تحتاج لتحديث الـ selectors في الكود

### خطأ: "تم اكتشاف Captcha"

**الحل:**
- الموقع قد اكتشف الاستخدام الآلي
- انتظر 10-15 دقيقة قبل المحاولة مرة أخرى
- قلل السرعة بزيادة `time.sleep()`
- جرّب استخدام VPN أو تغيير IP

---

## نصائح للاستخدام الأمثل

### 1. السرعة المثلى
- للاستخدام الآمن: 2-3 ثوان بين كل استعلام
- لتجنب Captcha: 4-5 ثوان بين كل استعلام

### 2. الكميات الكبيرة
- قسّم البيانات إلى دفعات (مثلاً 1000 صف كل مرة)
- شغّل البرنامج في أوقات مختلفة من اليوم

### 3. النسخ الاحتياطي
- اعمل نسخة احتياطية من `progress.json` بشكل دوري
- اعمل نسخة من ورقة النتائج في Google Sheets

### 4. المراقبة
- راقب السجلات (logs) بانتظام
- تحقق من ورقة النتائج كل 100-200 صف
- إذا لاحظت حقول فارغة كثيرة، أوقف البرنامج وتحقق من الكود

---

## دعم

إذا واجهت مشكلة لم تُذكر هنا:

1. تحقق من السجلات في console
2. تأكد من تحديث جميع المكتبات
3. جرّب إعادة تشغيل Replit
4. راجع ملف README.md
